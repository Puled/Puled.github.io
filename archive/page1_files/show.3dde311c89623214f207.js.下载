(window.webpackJsonp=window.webpackJsonp||[]).push([[193],{1241:function(t,e,i){t.exports=i.p+"img/avatar-default.54d64747.png"},1248:function(t,e,i){var n=i(1262);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,i(45).default)("483890dc",n,!0,{sourceMap:!1})},1249:function(t,e,i){"use strict";var n={props:{is_android:{type:Boolean,default:!1},is_show:{type:Boolean,default:!1},enable_cancel:{type:Boolean,default:!0}},data:function(){return{show:this.is_show,is_toggle:!1}},watch:{is_show:function(t){var e=this;this.show=t,t?(document.body.style.overflow="hidden",setTimeout((function(){e.is_toggle=!0}),100)):document.body.style.overflow=""}},beforeDestroy:function(){document.body.style.overflow=""},methods:{cancel:function(){var t=this;this.is_toggle=!1,setTimeout((function(){t.show=!1,document.body.style.overflow="",t.$emit("hide")}),200)}}},a=(i(1261),i(12)),s=Object(a.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.show?i("div",{class:{"weui-skin_android":t.is_android}},[i("div",{staticClass:"weui-mask max-screen-wrapper",on:{click:function(e){return e.preventDefault(),t.cancel(e)}}}),t._v(" "),i("div",{class:[{"weui-actionsheet_toggle":t.is_toggle},"weui-actionsheet"]},[i("div",{staticClass:"weui-actionsheet__menu"},[t._t("default")],2),t._v(" "),t.enable_cancel?i("div",{staticClass:"weui-actionsheet__action"},[i("div",{staticClass:"weui-actionsheet__cell",on:{click:function(e){return e.preventDefault(),t.cancel(e)}}},[t._v(t._s(t.$t("取消")))])]):t._e()])]):t._e()}),[],!1,null,"e43d6e4c",null);e.a=s.exports},1255:function(t,e,i){var n=i(1290);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,i(45).default)("56a6f64e",n,!0,{sourceMap:!1})},1261:function(t,e,i){"use strict";i(1248)},1262:function(t,e,i){(e=i(44)(!1)).push([t.i,".weui-actionsheet__cell[data-v-e43d6e4c]{line-height:30px;color:#333}.weui-actionsheet__cell.red[data-v-e43d6e4c]{color:red}",""]),t.exports=e},1289:function(t,e,i){"use strict";i(1255)},1290:function(t,e,i){(e=i(44)(!1)).push([t.i,".flex-box[data-v-0be5d29c]{display:flex;width:100%;text-align:left}.flex-box .flex-box-item[data-v-0be5d29c]{min-width:20px;width:0}",""]),t.exports=e},1299:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return r}));var n={name:"flex-box",props:{direction:{type:String,default:"row"},wrap:{type:String,default:"nowrap"},justify:{type:String,default:"flex-start"},align:{type:String,default:"flex-start"},alignContent:{type:String,default:"flex-start"}},computed:{style:function(){return{"justify-content":this.justify,"-webkit-justify-content":this.justify,"align-items":this.align,"-webkit-align-items":this.align,"flex-wrap":this.wrap,"-webkit-flex-wrap":this.wrap,"flex-direction":this.direction,"-webkit-flex-direction":this.direction,"align-content":this.alignContent,"-webkit-align-content":this.alignContent}}}},a=(i(1289),i(12)),s=Object(a.a)(n,(function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"flex-box",style:this.style},[this._t("default")],2)}),[],!1,null,"0be5d29c",null).exports,o=(i(79),{name:"flex-box-item",props:{flex:{type:Number,default:1}},computed:{style:function(){return{flex:this.flex,"-webkit-flex":this.flex}}}}),r=Object(a.a)(o,(function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"flex-box-item",style:this.style},[this._t("default")],2)}),[],!1,null,null,null).exports},1773:function(t,e,i){var n=i(2325);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,i(45).default)("3c10561c",n,!0,{sourceMap:!1})},1774:function(t,e,i){var n=i(2327);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,i(45).default)("50da87bf",n,!0,{sourceMap:!1})},1775:function(t,e,i){var n=i(2329);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,i(45).default)("43119b9e",n,!0,{sourceMap:!1})},2324:function(t,e,i){"use strict";i(1773)},2325:function(t,e,i){(e=i(44)(!1)).push([t.i,".icon-thread-owner[data-v-0f15b2cb]{width:33px;font-size:12px;line-height:12px;padding:3px 0;background-color:#dee0e8;border-radius:4px;color:#fff;text-align:center}.icon-pinned-post[data-v-0f15b2cb]{width:27px;height:14px;line-height:14px;padding:1px 2px;font-size:12px;background-color:transparent;border-radius:3px;border:1px solid #fc7d6e;color:#fc7d6e;text-align:center}.icon-like-post[data-v-0f15b2cb]{width:16px;height:14px;display:inline-block;background-position:-58px -1224px;vertical-align:text-top}.like-post-btn.active .icon-like-post[data-v-0f15b2cb]{background-position:-89px -1224px}.ref-content[data-v-0f15b2cb]{display:block;color:#787878;font-size:14px;margin-bottom:10px;line-height:24px;background-color:#f7f7f7;padding:8px;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}",""]),t.exports=e},2326:function(t,e,i){"use strict";i(1774)},2327:function(t,e,i){(e=i(44)(!1)).push([t.i,".pagination-container[data-v-487c8d58]{display:flex;padding:10px 11px}.pagination-container .pager[data-v-487c8d58]{position:relative;cursor:pointer;flex:1;margin:4px;text-align:center;background-color:#f2f3f6;line-height:40px}.pagination-container .select[data-v-487c8d58]{position:relative;background-color:#fff;border:1px solid #f2f3f6}.pagination-container .select>select[data-v-487c8d58]{cursor:pointer;position:absolute;left:0;top:0;opacity:0;width:100%;height:100%}.pagination-container .select>select option[data-v-487c8d58]{width:100%;height:100%}.pagination-container .disabled[data-v-487c8d58]{background-color:#f8f9fa;color:#bcbcbc}",""]),t.exports=e},2328:function(t,e,i){"use strict";i(1775)},2329:function(t,e,i){(e=i(44)(!1)).push([t.i,".thread-show-container{padding-bottom:44px}.thread-show-container .icon-concern-post,.thread-show-container .icon-like-post{width:16px;height:14px;display:inline-block;background-position:-58px -1224px;vertical-align:text-top}.thread-show-container .icon-concern-post{background-position:-146px -1224px}.thread-show-container .like-post-btn.active .icon-like-post{background-position:-89px -1224px}.thread-show-container .like-post-btn.active .icon-concern-post{background-position:-118px -1224px}.thread-show-container .post-order{padding:12px 15px;background:#f2f2f2;color:#666}.thread-show-container .post-order .post-replay{font-size:16px;color:#333;letter-spacing:0}.thread-show-container .post-order .right{font-size:14px;color:#666;letter-spacing:0}.thread-show-container .post-order .icon-order{width:16px;height:14px;display:inline-block;background-position:5px -2420px;vertical-align:text-top}.thread-show-container .fixed-bottom-bar{display:flex;position:fixed;bottom:0;left:0;width:100%;border-top:1px solid #ebebeb;background-color:#fbfbfb;z-index:1;box-sizing:border-box;-webkit-box-sizing:border-box}.thread-show-container .fixed-bottom-bar .input-fake{flex:1;height:27px;line-height:27px;margin:8px 0 8px 10px;font-size:14px;color:#888;background-position:0 -498px}.thread-show-container .fixed-bottom-bar .input-fake .icon-post{width:18px;height:18px;display:inline-block;vertical-align:middle;background-position:0 -503px}.thread-show-container .tag-container{padding:10px 15px;line-height:30px;height:30px;background-color:#fff;overflow:hidden;align-items:normal;border-bottom:1px solid #e5e5e5}.thread-show-container .tag-container .tag{padding:5px 14px;margin:0 10px 10px 0;line-height:20px;text-align:center;font-size:13px;color:#898996;background-color:#f4f5f8;border-radius:18px;min-width:30px;max-width:52px;display:inline-block;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.thread-show-container .tag-container .tag:last-child{margin-right:0}.thread-show-container .blue-point{width:6px;height:6px;border-radius:3px;opacity:.5;background:#008dfc;display:inline-block;margin-right:5px}.thread-show-container .related-thread{background:rgba(165,176,199,.1);border-radius:4px;margin:20px 0 10px;padding:16px 22px 11px 11px}.thread-show-container .related-thread .related-title{display:inline-block;font-size:16px;color:#333}.thread-show-container .related-thread .related-title .t-wrap{width:10px;margin-right:12px;position:relative}.thread-show-container .related-thread .related-title .t-wrap span{position:absolute}.thread-show-container .related-thread .related-title .t-wrap span.triangle-right{top:3px;width:0;height:0;display:inline-block;border-top:5px solid transparent;border-bottom:5px solid transparent;border-left:8px solid #259}.thread-show-container .related-thread .related-title .t-wrap span.triangle-bottom{top:4px;width:0;height:0;display:inline-block;border-left:5px solid transparent;border-right:5px solid transparent;border-top:8px solid #259}.thread-show-container .related-thread ul{margin-top:10px;margin-left:10px}.thread-show-container .related-thread ul li{padding:2px 0}.thread-show-container .related-thread ul li a{margin-left:5px;font-size:14px;color:#259;letter-spacing:0;line-height:22px}.weui-media-box__info.info{margin-top:-8px}.weui-media-box__info .weui-media-box__info__meta{line-height:15px}.thread-posts{margin-bottom:50px}.thread-content{overflow-y:auto}",""]),t.exports=e},3448:function(t,e,i){"use strict";i.r(e);var n=i(1299),a=i(1249),s={name:"post-item",props:{thread:{type:Object,default:null},post:{type:Object,default:null}},filters:{likeText:function(t){return t.is_liked||t.like_count>0?"".concat(t.like_count):"赞"}},components:{actionsheet:a.a},data:function(){return{isShowActionsheet:!1,isLiking:!1,ownerAvatar:this.post.owner.avatar}},computed:{isCompanyManager:function(){return this.$store.state.auth.is_company_manager},staffId:function(){return this.$store.state.user.staff_uuid},enablePictureWatermark:function(){return this.$store.state.versionControl.grays.admin_enable_watermark_in_thread_pic}},methods:{staffRedirect:function(t){if(t.id){var e=this.$options.filters.url_suffix(this.$options.filters.app_url(t));this.$router.push(e)}},unpinPost:function(t,e){var i=this;e.pinned_at=!1,this.$store.dispatch("thread/unpin_post",{thread_id:t.id,post_id:e.id}).then((function(){i.$toast({msg:"取消置顶成功",type:"text",callback:function(){i.$emit("on-unpin-post",e)}})}))},pinPost:function(t,e){var i=this;e.pinned_at=!0,this.$store.dispatch("thread/pin_post",{thread_id:t.id,post_id:e.id}).then((function(){i.$toast({msg:"置顶成功",type:"text",callback:function(){i.$emit("on-pin-post",e)}})}))},destroyPost:function(t){var e=this,i=t;this.isShowActionsheet=!1,e.$confirm({msg:"确认要删除该回帖吗？"},(function(){e.$emit("on-destroy-post",i)}))},like:function(t){var e=this,i=t.is_liked?"delete":"put",n="/staff/likes/".concat(t.model,"s/").concat(t.id);this.isLiking||(this.isLiking=!0,this.$http[i](n).then((function(){"put"===i?t.like_count++:t.like_count--,t.is_liked=!t.is_liked})).then((function(){e.isLiking=!1})).catch((function(t){return e.httpError(t)})))}}},o=(i(2324),i(12)),r=Object(o.a)(s,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"thread-post weui-media-box weui-media-box_text"},[t.post.owner?n("div",{staticClass:"weui-flex"},[n("div",{staticClass:"relative left mr-m"},[n("img",{staticClass:"avatar-md",attrs:{src:t.ownerAvatar},on:{click:function(e){return e.stopPropagation(),t.staffRedirect(t.post.owner)},error:function(e){t.ownerAvatar=i(1241)}}}),t._v(" "),t.post.owner.is_vip?n("span",{staticClass:"icon-vip-avatar bg-sprites"}):t._e()]),t._v(" "),n("div",{staticClass:"weui-flex__item"},[n("div",{staticClass:"weui-flex mb-s"},[n("div",{staticClass:"weui-flex__item"},[n("div",{staticClass:"staff-name mb-s"},[t._v(t._s(t.post.owner.display_name))])]),t._v(" "),n("div",{staticClass:"clearfix"},[n("div",{staticClass:"icon-thread-owner right"},[t._v(t._s(t.post.floor)+"楼")]),t._v(" "),t.post.is_pinned?n("div",{staticClass:"icon-pinned-post mr-s right"},[t._v("置顶")]):t._e()])]),t._v(" "),t.post.reference?n("div",{staticClass:"ref-content long-break"},[n("span",{staticClass:"ref-info"},[t._v("\n          回复 "+t._s(t.post.reference.floor)+"#楼\n          "+t._s(t.post.reference.owner?t.post.reference.owner.display_name:t.post.reference.created_by)+"\n          "+t._s(t.post.reference.deleted_at?"(此楼层已删除)":"")+"\n        ")]),t._v("\n        "+t._s(t.post.reference.deleted_at?"":t.post.reference.summary)+"\n      ")]):t._e(),t._v(" "),n("div",{directives:[{name:"wx-preview-image",rawName:"v-wx-preview-image"},{name:"highlight",rawName:"v-highlight"},{name:"lazy-load",rawName:"v-lazy-load",value:t.enablePictureWatermark,expression:"enablePictureWatermark"},{name:"videos",rawName:"v-videos",value:"post",expression:"'post'"},{name:"tencent-videos",rawName:"v-tencent-videos"},{name:"enable-copy-limit",rawName:"v-enable-copy-limit"}],staticClass:"view-content",domProps:{innerHTML:t._s(t.post.content)}}),t._v(" "),n("div",{staticClass:"mt-s font-sm"},[n("span",{staticClass:"blue mr-m like-post-btn",class:t.post.is_liked?"active":"",on:{click:function(e){return t.like(t.post)}}},[n("span",{staticClass:"bg-sprites icon-like-post"}),t._v("\n          "+t._s(t._f("likeText")(t.post))+"\n        ")]),t._v(" "),t.thread.lock_at?t._e():n("nuxt-link",{staticClass:"blue mr-m",attrs:{tag:"span",to:t._f("url_suffix")("/threads/"+t.thread.id+"/posts/create?ref_id="+t.post.id)}},[t._v("\n          回复\n        ")]),t._v(" "),t.post.is_owner?n("span",{staticClass:"blue mr-m",on:{click:function(e){return t.destroyPost(t.post)}}},[t._v("删除")]):t._e(),t._v(" "),t.isCompanyManager?[n("span",{staticClass:"blue",on:{click:function(e){t.isShowActionsheet=!0}}},[t._v("管理")]),t._v(" "),n("actionsheet",{attrs:{is_show:t.isShowActionsheet},on:{hide:function(e){t.isShowActionsheet=!1}}},[t.post.pinned_at?n("div",{staticClass:"weui-actionsheet__cell",on:{click:function(e){return t.unpinPost(t.thread,t.post)}}},[t._v("取消置顶")]):n("div",{staticClass:"weui-actionsheet__cell",on:{click:function(e){return t.pinPost(t.thread,t.post)}}},[t._v("置顶")]),t._v(" "),n("div",{staticClass:"weui-actionsheet__cell red",on:{click:function(e){return t.destroyPost(t.post)}}},[t._v("删除回帖")])])]:t._e(),t._v(" "),n("span",{staticClass:"lightgray right"},[t._v("\n          "+t._s(t._f("date_part")(t.post.created_at))+"\n        ")])],2)])]):t._e()])}),[],!1,null,"0f15b2cb",null).exports,c={name:"pagination",props:{pagination:{type:Object,default:function(){return{per_page:20,current_page:1,total:0}}}},computed:{total_page:function(){return Math.ceil(this.pagination.total/this.pagination.per_page)},is_show:function(){return this.pagination&&this.pagination.current_page<=this.total_page&&this.total_page>1}},methods:{prev:function(){1!==this.pagination.current_page&&(this.pagination.current_page--,this.$emit("on-callback",this.pagination))},next:function(){this.pagination.current_page!==this.total_page&&(this.pagination.current_page++,this.$emit("on-callback",this.pagination))},change:function(){this.$emit("on-callback",this.pagination)},first:function(){1!==this.pagination.current_page&&(this.pagination.current_page=1,this.$emit("on-callback",this.pagination))},last:function(){this.pagination.current_page!==this.total_page&&(this.pagination.current_page=this.total_page,this.$emit("on-callback",this.pagination))}}},l=(i(2326),Object(o.a)(c,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.is_show,expression:"is_show"}],staticClass:"pagination-container"},[i("div",{staticClass:"pager",class:1===t.pagination.current_page?"disabled":"",on:{click:t.first}},[t._v("首页")]),t._v(" "),i("div",{staticClass:"pager",class:1===t.pagination.current_page?"disabled":"",on:{click:t.prev}},[t._v("上页")]),t._v(" "),i("div",{staticClass:"pager select"},[t._v("\n        "+t._s(t.pagination.current_page+"/"+t.total_page)+"\n        "),i("select",{directives:[{name:"model",rawName:"v-model",value:t.pagination.current_page,expression:"pagination.current_page"}],on:{change:[function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.pagination,"current_page",e.target.multiple?i:i[0])},t.change]}},t._l(t.total_page,(function(e){return i("option",{domProps:{value:e}},[t._v(t._s("第"+e+"页"))])})),0)]),t._v(" "),i("div",{staticClass:"pager",class:t.pagination.current_page===t.total_page?"disabled":"",on:{click:t.next}},[t._v("下页")]),t._v(" "),i("div",{staticClass:"pager",class:t.pagination.current_page===t.total_page?"disabled":"",on:{click:t.last}},[t._v("末页")])])}),[],!1,null,"487c8d58",null).exports),d=(i(22),i(18),i(13),i(4),i(17),i(0));i(101),i(60),i(79);function h(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function p(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?h(Object(i),!0).forEach((function(e){Object(d.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):h(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var u={name:"thread-show",mixins:[{data:function(){return{showRealtedThread:!0,threadId:this.$route.params.threadId,posts:[],pinnedPosts:[],pagination:{per_page:20,current_page:Number(this.$route.query.page)||1,total:0},preRequest:null,isLiking:!1,isConcerning:!1,isShow:!1,isShowOrderActionsheet:!1,isShowSettingActionsheet:!1,isShowQDetail:!0}},filters:{likeText:function(t){return t.is_liked||t.like_count>0?"".concat(t.like_count):"赞"}},computed:{isCompanyManager:function(){return this.$store.state.auth.is_company_manager},staffId:function(){return this.$store.state.user.staff_uuid},orderBy:function(){return"desc"==this.$route.query.order?"按时间倒序":"按时间正序"}},watch:{$route:{handler:function(t){var e=Number(t.query.page)||1,i=t.query.order||"asc";this.pagination.current_page=e||this.pagination.current_page,this.posts=[],this.getPosts(this.pagination,i),window.scrollTo(0,0)},immediate:!0}},methods:{categoryOnSelect:function(t){this.$router.push("/threads?category_id=".concat(t))},like:function(t){var e=this,i=t.is_liked?"delete":"put",n="/staff/likes/".concat(t.model,"s/").concat(t.id);this.isLiking||(this.isLiking=!0,this.$http[i](n).then((function(){"put"===i?t.like_count++:t.like_count--,t.is_liked=!t.is_liked})).then((function(){e.isLiking=!1})).catch((function(t){return e.httpError(t)})))},concern:function(t){var e=this;if(this.isConcerning)return!1;var i=t.is_concerned,n=i?"delete":"put";this.isConcerning=!0,this.$http({method:n,url:"/staff/concerns/threads/".concat(t.id)}).then((function(n){t.is_concerned=!i,e.isConcerning=!1,window.Bus.$emit("micro:update")})).catch((function(t){return e.httpError(t)}))},order:function(t){this.$router.replace("/threads/".concat(this.threadId,"?order=").concat(t)),this.isShowOrderActionsheet=!1,this.isShowQDetail=!0},changePage:function(){var t=this.$route.query.order?"?order=".concat(this.$route.query.order):"",e=1===this.pagination.current_page?"":"".concat(t?"&":"?","page=").concat(this.pagination.current_page);this.isShowQDetail=1==this.pagination.current_page,this.$router.push("/threads/".concat(this.threadId).concat(t).concat(e))},getPosts:function(t,e){var i=this,n={page:t.current_page,limit:t.per_page,order:e};this.preRequest&&this.preRequest.abort(),1===t.current_page?this.getPinnedPosts():this.pinnedPosts=[],this.isShow=!1,this.$http.get("/threads/".concat(this.threadId,"/posts?lazy_load=1"),{params:n,before:function(t){this.preRequest=t}}).then((function(t){var e=t.data;i.posts=e.data.map((function(t){return t.content=t.content.parseLink(),t})),i.pagination=Object.assign(i.pagination,{current_page:e.current_page,total:e.total}),i.preRequest=null,i.isShow=!0})).catch((function(t){i.preRequest=null,i.httpError(t)}))},getPinnedPosts:function(){var t=this;this.$http.get("/threads/".concat(this.threadId,"/posts?is_pinned=1&limit=10")).then((function(e){var i=e.data;t.pinnedPosts=i.map((function(t){return t.content=t.content.parseLink(),t.is_pinned=!0,t}))})).catch((function(e){t.httpError(e)}))},pinGlobalThread:function(){var t=this;this.isShowSettingActionsheet=!1,this.thread.global_pinned_at=!0,this.$store.dispatch("thread/pin_thread",{thread_id:this.thread.id,type:"global"}).then((function(){t.$toast({msg:"置顶成功"})}))},unpinGlobalThread:function(){var t=this;this.isShowSettingActionsheet=!1,this.thread.global_pinned_at=!1,this.$store.dispatch("thread/unpin_thread",{thread_id:this.thread.id,type:"global"}).then((function(){t.$toast({msg:"取消置顶成功"})}))},pinCategoryThread:function(){var t=this;this.isShowSettingActionsheet=!1,this.thread.category_pinned_at=!0,this.$store.dispatch("thread/pin_thread",{thread_id:this.thread.id,type:"category"}).then((function(){t.$toast({msg:"置顶成功"})}))},unpinCategoryThread:function(){var t=this;this.isShowSettingActionsheet=!1,this.thread.category_pinned_at=!1,this.$store.dispatch("thread/unpin_thread",{thread_id:this.thread.id,type:"category"}).then((function(){t.$toast({msg:"取消置顶成功"})}))},recommendThread:function(){var t=this,e=this.thread.recommended_at?"delete":"put",i=this.thread.recommended_at?"取消推荐成功":"推荐成功";this.isShowSettingActionsheet=!1,this.$http[e]("/threads/".concat(this.thread.id,"/recommend")).then((function(){t.thread.recommended_at=t.thread.recommended_at?null:(new Date).format("yyyy-MM-dd hh:mm:ss"),t.$toast({msg:i,type:"text"})})).catch((function(e){return t.httpError(e)}))},lockThread:function(){var t=this;this.isShowSettingActionsheet=!1;var e=function(e){t.$http.put(e).then((function(){t.thread.lock_at=t.thread.lock_at?null:(new Date).format("yyyy-MM-dd hh:mm")})).catch((function(e){return t.httpError(e)}))};this.thread.lock_at?e("/threads/".concat(this.thread.id,"/un-lock")):this.$confirm({msg:"锁帖后将无法在添加回帖，确定要锁帖吗？"}).then((function(i){i&&e("/threads/".concat(t.thread.id,"/lock"))}))},sinkThread:function(){var t=this;this.isShowSettingActionsheet=!1;var e="/threads/".concat(this.thread.id,"/").concat(this.thread.sinked_at?"un-sink":"sink"),i=function(e){t.$http.put(e).then((function(){t.thread.sinked_at=t.thread.sinked_at?null:(new Date).format("yyyy-MM-dd hh:mm")})).catch((function(e){return t.httpError(e)}))};this.thread.sinked_at?i(e):this.$confirm({msg:"沉帖后帖子将置于列表底部，确定要沉帖吗？"}).then((function(t){t&&i(e)}))},destroyThread:function(){var t=this;this.isShowSettingActionsheet=!1,this.$confirm({msg:"确认要删除该帖子吗？"}).then((function(e){e&&t.$http.delete("/threads/".concat(t.thread.id)).then((function(){t.$store.dispatch("thread/delete_thread",{id:t.thread.id}),t.$toast({type:"text",msg:"删除成功",callback:function(){return t.$router.replace("/threads")}})})).catch((function(){t.$toast({type:"text",msg:"删除失败"})}))}))},destroyPost:function(t){var e=this;this.isShowSettingActionsheet=!1,this.$http.delete("/threads/".concat(this.thread.id,"/posts/").concat(t.id)).then((function(){var i=e.posts.findIndex((function(e){return e.id===t.id}));e.posts.splice(i,1),e.thread.post_count--,e.$toast({type:"text",msg:"删除成功"})})).catch((function(t){e.$toast({type:"text",msg:"删除失败"}),e.httpError(t)}))},pinPost:function(t){var e=p(p({},t),{},{is_pinned:!0});this.pinnedPosts.unshift(e),this.isShowSettingActionsheet=!1},unPinPost:function(t){this.isShowSettingActionsheet=!1,this.pinnedPosts=this.pinnedPosts.filter((function(e){return e.id!=t.id})),this.posts=this.posts.map((function(e){return e.id==t.id&&(e.pinned_at=!1),e}))},editPost:function(){this.isShowSettingActionsheet=!1}}}],components:{flexBox:n.a,flexBoxItem:n.b,actionsheet:a.a,postItem:r,pagination:l},data:function(){return{thread:{}}},computed:{isShowThread:function(){return!this.$isPcg||this.isShow},enablePictureWatermark:function(){return this.$store.state.versionControl.grays.admin_enable_watermark_in_thread_pic}},mounted:function(){var t=this;this.init((function(){return t.$wx.share({title:t.thread.title,desc:t.thread.summary})}))},methods:{init:function(t){var e=this;this.$http.get("/threads/".concat(this.$route.params.threadId,"?lazy_load=1&increment=1&prompt_style=page")).then((function(i){var n=i.data;n.content=n.content.parseLink(),e.thread=n,t&&t()})).catch((function(t){return e.httpError(t)}))}}},_=(i(2328),Object(o.a)(u,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.thread.id&&t.isShowThread?n("div",{directives:[{name:"watermark",rawName:"v-watermark",value:{type:"thread"},expression:"{ type: 'thread' }"}],staticClass:"thread-show-container min-height bg-default"},[n("div",{staticClass:"view-container"},[n("div",{staticClass:"title long-break"},[t._v(t._s(t.thread.title))]),t._v(" "),t.isShowQDetail?[n("ul",{staticClass:"weui-media-box__info mb-m info"},[n("li",{staticClass:"weui-media-box__info__meta lightgray"},[n("span",{staticClass:"bg-sprites icon-read-count"}),t._v("\n          "+t._s(t.thread.read_count)+"\n        ")]),t._v(" "),n("li",{staticClass:"weui-media-box__info__meta lightgray right no-padding"},[t._v("\n          "+t._s(t._f("date_part")(t.thread.created_at))+"\n        ")])]),t._v(" "),n("flex-box",{staticClass:"mb-m",attrs:{align:"center"}},[n("div",{staticClass:"left mr-m"},[t.thread.is_anonymous?n("img",{staticClass:"avatar-md",attrs:{src:t.thread.owner.avatar},on:{error:function(e){t.thread.owner.avatar=i(1241)}}}):n("nuxt-link",{staticClass:"relative",attrs:{to:t._f("url_suffix")(t._f("app_url")(t.thread.owner))}},[n("img",{staticClass:"avatar-md",attrs:{src:t.thread.owner.avatar},on:{error:function(e){t.thread.owner.avatar=i(1241)}}})])],1),t._v(" "),n("flex-box-item",[n("div",{staticClass:"staff-name single-line"},[t._v(t._s(t.thread.owner.display_name))])])],1),t._v(" "),n("div",{directives:[{name:"wx-preview-image",rawName:"v-wx-preview-image"},{name:"highlight",rawName:"v-highlight"},{name:"lazy-load",rawName:"v-lazy-load",value:t.enablePictureWatermark,expression:"enablePictureWatermark"},{name:"audios",rawName:"v-audios"},{name:"videos",rawName:"v-videos"},{name:"tencent-videos",rawName:"v-tencent-videos"},{name:"enable-copy-limit",rawName:"v-enable-copy-limit"}],staticClass:"view-content thread-content",domProps:{innerHTML:t._s(t.$options.filters.filterBigBase64(t.thread.content))}}),t._v(" "),t.thread.related_threads&&t.thread.related_threads.length?n("div",{staticClass:"related-thread"},[n("div",{staticClass:"blue-point"}),t._v(" "),n("div",{staticClass:"related-title"},[t._v("相关帖子")]),t._v(" "),n("ul",t._l(t.thread.related_threads,(function(e){return n("li",{key:e.target.id},[n("a",{staticClass:"c-line-clamp1",attrs:{href:"/threads/"+e.target.id}},[t._v(t._s(e.target.title))])])})),0)]):t._e(),t._v(" "),n("ul",{staticClass:"weui-media-box__info"},[t.thread.is_owner?t._e():n("li",{staticClass:"weui-media-box__info__meta"},[n("span",{staticClass:"blue like-post-btn",class:t.thread.is_concerned?"active":"",on:{click:function(e){return t.concern(t.thread)}}},[n("span",{staticClass:"bg-sprites icon-concern-post"}),t._v("\n            "+t._s(t.thread.is_concerned?"已关注":"关注")+"\n          ")])]),t._v(" "),n("li",{staticClass:"weui-media-box__info__meta"},[n("span",{staticClass:"blue like-post-btn",class:t.thread.is_liked?"active":"",on:{click:function(e){return t.like(t.thread)}}},[n("span",{staticClass:"bg-sprites icon-like-post"}),t._v("\n            "+t._s(t._f("likeText")(t.thread))+"\n          ")])]),t._v(" "),t.thread.is_owner?n("li",{staticClass:"weui-media-box__info__meta",on:{click:t.destroyThread}},[n("span",{staticClass:"blue"},[t._v("删除")])]):t._e(),t._v(" "),t.isCompanyManager?n("li",{staticClass:"weui-media-box__info__meta",on:{click:function(e){t.isShowSettingActionsheet=!0}}},[n("span",{staticClass:"blue"},[t._v("管理")])]):t._e(),t._v(" "),t.isCompanyManager?[n("actionsheet",{attrs:{is_show:t.isShowSettingActionsheet},on:{hide:function(e){t.isShowSettingActionsheet=!1}}},[t.isCompanyManager?n("div",{staticClass:"weui-actionsheet__cell"},[n("nuxt-link",{attrs:{tag:"div",to:t._f("url_suffix")("/threads/"+t.thread.id+"/push")}},[t._v("推送给部门或成员")])],1):t._e(),t._v(" "),t.thread.global_pinned_at?n("div",{staticClass:"weui-actionsheet__cell",on:{click:t.unpinGlobalThread}},[t._v("\n              取消全"+t._s(t.replaceStaticByConfig("thread","论坛"))+"置顶\n            ")]):n("div",{staticClass:"weui-actionsheet__cell",on:{click:t.pinGlobalThread}},[t._v("\n              全"+t._s(t.replaceStaticByConfig("thread","论坛"))+"置顶\n            ")]),t._v(" "),t.thread.category_pinned_at?n("div",{staticClass:"weui-actionsheet__cell",on:{click:t.unpinCategoryThread}},[t._v("\n              取消版块置顶\n            ")]):n("div",{staticClass:"weui-actionsheet__cell",on:{click:t.pinCategoryThread}},[t._v("版块置顶")]),t._v(" "),n("div",{staticClass:"weui-actionsheet__cell",on:{click:t.recommendThread}},[t._v("\n              "+t._s(t.thread.recommended_at?"取消推荐":"推荐")+"\n            ")]),t._v(" "),n("div",{staticClass:"weui-actionsheet__cell",on:{click:t.lockThread}},[t._v("\n              "+t._s(t.thread.lock_at?"取消锁帖":"锁帖")+"\n            ")]),t._v(" "),n("div",{staticClass:"weui-actionsheet__cell",on:{click:t.sinkThread}},[t._v("\n              "+t._s(t.thread.sinked_at?"取消沉帖":"沉帖")+"\n            ")]),t._v(" "),n("div",{staticClass:"weui-actionsheet__cell red",on:{click:t.destroyThread}},[t._v("删除主帖")])])]:t._e()],2)]:t._e()],2),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}],key:t.pagination.current_page,staticClass:"thread-posts weui-panel"},[n("div",{staticClass:"post-order"},[n("span",{staticClass:"post-replay"},[t._v(t._s(t.thread.post_count)+"个回帖")]),t._v(" "),n("span",{staticClass:"right",on:{click:function(e){t.isShowOrderActionsheet=!0}}},[t._v("\n        "+t._s(t.orderBy)+"\n        "),n("span",{staticClass:"bg-sprites icon-order"})]),t._v(" "),n("actionsheet",{attrs:{is_show:t.isShowOrderActionsheet},on:{hide:function(e){t.isShowOrderActionsheet=!1}}},[n("div",{staticClass:"weui-actionsheet__cell",on:{click:function(e){return t.order("asc")}}},[t._v("按时间正序")]),t._v(" "),n("div",{staticClass:"weui-actionsheet__cell",on:{click:function(e){return t.order("desc")}}},[t._v("按时间倒序")])])],1),t._v(" "),t._l(t.pinnedPosts.concat(t.posts),(function(e,i){return n("post-item",{key:e.id+"-"+i,attrs:{post:e,thread:t.thread},on:{"on-destroy-post":t.destroyPost,"on-pin-post":t.pinPost,"on-unpin-post":t.unPinPost}})})),t._v(" "),n("pagination",{attrs:{pagination:t.pagination},on:{"on-callback":t.changePage}})],2),t._v(" "),t.thread.lock_at?t._e():n("div",{staticClass:"fixed-bottom-bar iphonex-padding-bottom max-screen-wrapper"},[n("nuxt-link",{staticClass:"input-fake",attrs:{tag:"div",to:t._f("url_suffix")("/threads/"+t.thread.id+"/posts/create")}},[n("span",{staticClass:"icon-post bg-sprites"}),t._v("\n      回帖\n    ")])],1)]):t._e()}),[],!1,null,null,null));e.default=_.exports}}]);
//# sourceMappingURL=show.3dde311c89623214f207.js.map