(window.webpackJsonp=window.webpackJsonp||[]).push([[189],{1240:function(t,e,i){t.exports=function(t){var e={};function i(a){if(e[a])return e[a].exports;var s=e[a]={i:a,l:!1,exports:{}};return t[a].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(a,s,function(e){return t[e]}.bind(null,s));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=112)}({112:function(t,e,i){t.exports=i(51)},2:function(t,e,i){"use strict";function a(t,e,i,a,s,o,n,r){var c,l="function"==typeof t?t.options:t;if(e&&(l.render=e,l.staticRenderFns=i,l._compiled=!0),a&&(l.functional=!0),o&&(l._scopeId="data-v-"+o),n?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(n)},l._ssrRegister=c):s&&(c=r?function(){s.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:s),c)if(l.functional){l._injectStyles=c;var d=l.render;l.render=function(t,e){return c.call(e),d(t,e)}}else{var u=l.beforeCreate;l.beforeCreate=u?[].concat(u,c):[c]}return{exports:t,options:l}}i.d(e,"a",(function(){return a}))},51:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"loadmore-container"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.empty&&t.active,expression:"!empty && active"}],staticClass:"weui-loadmore",class:{active:t.active,hidden:!t.active}},[i("i",{staticClass:"weui-loading"}),t._v(" "),i("span",{staticClass:"weui-loadmore__tips",style:{backgroundColor:t.backgroundColor}},[t._v(t._s(t.loadingText))])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isNew&&t.empty,expression:"!isNew && empty"}],staticClass:"weui-loadmore weui-loadmore_line"},[i("span",{staticClass:"weui-loadmore__tips",style:{backgroundColor:t.backgroundColor}},[t._v(t._s(t.emptyText))])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isNew&&t.empty,expression:"isNew && empty"}],staticClass:"load-finished"},[t._v(t._s(t.emptyText))])])};a._withStripped=!0;var s={name:"nova-loadmore",props:{active:{type:Boolean,default:!1},empty:{type:Boolean,default:!1},loadingText:{type:String,default:"正在加载"},emptyText:{type:String,default:"已显示全部内容"},backgroundColor:{type:String,default:"#fff"},isNew:{type:Boolean,default:!1}}},o=i(2),n=Object(o.a)(s,a,[],!1,(function(t){var e=i(81);e.__inject__&&e.__inject__(t)}),"687517a2","45a98a62");n.options.__file="src/components/loadmore/loadmore.vue";var r=n.exports;r.install=function(t){t.component(r.name,r)},e.default=r},81:function(t,e,i){"use strict";i.r(e)}})},1245:function(t,e,i){var a=i(23),s=i(506)(!0);a(a.S,"Object",{entries:function(t){return s(t)}})},1252:function(t,e,i){var a=i(1278);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i(45).default)("6c69122e",a,!0,{sourceMap:!1})},1257:function(t,e,i){var a=i(1293);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i(45).default)("5db4409c",a,!0,{sourceMap:!1})},1277:function(t,e,i){"use strict";i(1252)},1278:function(t,e,i){(e=i(44)(!1)).push([t.i,".weui-search-bar__label .weui-icon-search[data-v-30d620e5],.weui-search-bar__label span[data-v-30d620e5]{margin-top:2px}",""]),t.exports=e},1281:function(t,e,i){"use strict";var a={name:"search-bar",directives:{focus:function(t,e,i){var a=e.value,s=i.context;a&&(s.toggle_search(!0),s.$nextTick().then((function(){return t.focus()})))}},props:{placeholder:{type:String,default:"搜索"},autocomplete:{type:String,default:"off"},init_value:{type:String,default:""},autofocus:{type:Boolean,default:!1}},data:function(){return{value:this.init_value.trim(),is_search:Boolean(this.init_value.trim()),is_focus:this.autofocus}},methods:{clear:function(){this.value=""},cancel:function(){this.value="",this.toggle_search(!1),this.$emit("on-cancel")},submit:function(){this.value.trim()&&this.$emit("on-submit",this.value)},blur:function(){this.is_focus=!1},change:function(){this.$emit("on-change",this.value)},toggle_search:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.is_search=t,this.is_focus=t}},watch:{init_value:function(t){this.value=t,this.is_search=!0}}},s=(i(1277),i(12)),o=Object(s.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("section",[i("div",{staticClass:"weui-search-bar",class:{"weui-search-bar_focusing":t.is_search},attrs:{id:"search_bar"}},[i("form",{staticClass:"weui-search-bar__form",attrs:{action:"post"},on:{submit:function(e){return e.preventDefault(),t.submit(e)},click:function(e){return e.stopPropagation(),t.toggle_search(!0)}}},[i("div",{staticClass:"weui-search-bar__box"},[i("i",{staticClass:"weui-icon-search"}),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.value,expression:"value",modifiers:{trim:!0}},{name:"focus",rawName:"v-focus",value:t.is_focus,expression:"is_focus"}],staticClass:"weui-search-bar__input",attrs:{type:"search",id:"search_input",placeholder:t.placeholder,autocomplete:t.autocomplete},domProps:{value:t.value},on:{blur:[t.blur,function(e){return t.$forceUpdate()}],change:t.change,input:function(e){e.target.composing||(t.value=e.target.value.trim())}}}),t._v(" "),i("a",{directives:[{name:"show",rawName:"v-show",value:t.value.trim(),expression:"value.trim()"}],staticClass:"weui-icon-clear",attrs:{id:"search_clear"},on:{click:function(e){return e.preventDefault(),t.clear(e)}}})]),t._v(" "),i("label",{staticClass:"weui-search-bar__label",attrs:{for:"search_input",id:"search_text"}},[i("i",{staticClass:"weui-icon-search"}),t._v(" "),i("span",[t._v(t._s(t.placeholder))])])]),t._v(" "),i("a",{staticClass:"weui-search-bar__cancel-btn",attrs:{id:"search_cancel"},on:{click:function(e){return e.preventDefault(),t.cancel(e)}}},[t._v(t._s(t.$t("取消")))])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.is_search,expression:"is_search"}],staticClass:"weui-cells weui-cells_access search_show no-margin",attrs:{id:"search_show"}},[t._t("ac-result-list")],2)])}),[],!1,null,"30d620e5",null);e.a=o.exports},1292:function(t,e,i){"use strict";i(1257)},1293:function(t,e,i){(e=i(44)(!1)).push([t.i,".user-list[data-v-170a4bbc]{position:fixed;top:0;right:0;width:100%;height:100%;background:#fff;z-index:4;overflow-y:scroll}.user-list .weui-media-box__hd[data-v-170a4bbc]{width:50px;height:50px}.user-list .weui-media-box__thumb[data-v-170a4bbc]{border-radius:50%}",""]),t.exports=e},1300:function(t,e,i){"use strict";i(4);var a=i(316),s=i.n(a),o=i(1260),n=i.n(o),r=i(1240),c=i.n(r),l={name:"user-at",components:{searchBar:i(1281).a,novaLoadmore:c.a,novaList:n.a,novaPopup:s.a},data:function(){return{keyword:"",staffs:[],page:1,limit:20,isFinished:!0,isLoading:!1}},methods:{loadData:function(){var t=this;this.isLoading=!0;var e={starts_with:this.keyword,page:this.page,limit:this.limit};this.$http.get("/staffs/at",{params:e}).then((function(e){var i=e.data.data.data;t.staffs=t.staffs.concat(i),i.length===t.limit&&(t.page=t.page+1),i.length<t.limit&&(t.isFinished=!0)})).catch((function(e){return t.httpError(e)})).finally((function(){t.isLoading=!1}))},submit:function(t){var e=this;this.isLoading||(this.keyword=t,this.reset(),this.$nextTick().then((function(){e.loadData()})))},user_at:function(t){this.$store.dispatch("comment/add_id_name_map",{id:t.id,name:t.display_name}),this.$emit("on-user-at",t.display_name),this.$emit("on-staff",{id:t.id,name:t.display_name})},reset:function(){this.page=1,this.isLoading=!1,this.isFinished=!1,this.staffs=[]}}},d=(i(1292),i(12)),u=Object(d.a)(l,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("nova-popup",{attrs:{show:!0,lockScroll:!0,animate:!1,position:"full-screen"}},[i("div",{staticClass:"user-list"},[i("search-bar",{attrs:{autocomplete:"on",autofocus:!0,placeholder:t.$t("搜索")},on:{"on-submit":t.submit}}),t._v(" "),i("nova-list",{attrs:{useBody:!1,loading:t.isLoading,finished:t.isFinished},on:{load:t.loadData}},[t._l(t.staffs,(function(e){return i("div",{key:e.id,staticClass:"weui-media-box weui-media-box_appmsg",on:{click:function(i){return t.user_at(e)}}},[i("div",{staticClass:"weui-media-box__hd"},[i("img",{staticClass:"weui-media-box__thumb",attrs:{src:e.avatar}})]),t._v(" "),i("div",{staticClass:"weui-media-box__bd"},[i("h4",{staticClass:"weui-media-box__title"},[t._v(t._s(e.display_name))]),t._v(" "),i("p",{staticClass:"weui-media-box__desc mt-s"},[t._v(t._s(e.organization))])])])})),t._v(" "),i("nova-loadmore",{attrs:{slot:"finished",empty:t.isFinished,"empty-text":t.isFinished&&!t.staffs.length?t.keyword?t.$t("暂无内容"):t.$t("请搜索您要邀请的同事名称"):t.$t("已显示所有内容")},slot:"finished"})],2)],1)])}),[],!1,null,"170a4bbc",null);e.a=u.exports},1337:function(t,e,i){var a=i(1390);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i(45).default)("6171b353",a,!0,{sourceMap:!1})},1368:function(t,e,i){var a=i(1453);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i(45).default)("5cbf54ef",a,!0,{sourceMap:!1})},1389:function(t,e,i){"use strict";i(1337)},1390:function(t,e,i){(e=i(44)(!1)).push([t.i,".expression-wrapper[data-v-61fa8290]{position:fixed;width:100%;height:230px;left:0;bottom:-280px;background-color:#eee;transition:bottom .4s ease;overflow:hidden;z-index:99;padding-top:9px}.expression-wrapper .expression-mask[data-v-61fa8290]{position:fixed;top:0;left:0;right:0;bottom:0;background-color:transparent;z-index:99}.expression-wrapper .expression-container[data-v-61fa8290]{position:absolute;left:0;height:200px;z-index:999}.expression-wrapper .expression-container.transition[data-v-61fa8290]{transition:left .2s ease}.expression-wrapper .expression-container .expression-page[data-v-61fa8290]{float:left}.expression-wrapper .expression-container .expression-page .expression-list[data-v-61fa8290]{display:flex;flex-wrap:wrap;padding:0 10px}.expression-wrapper .expression-container .expression-page .expression-list .expression-item[data-v-61fa8290]{position:relative;height:50px;flex:0 0 14.2857%}.expression-wrapper .expression-container .expression-page .expression-list .expression-item .expression-image[data-v-61fa8290]{position:absolute;top:50%;left:50%;width:28px;height:28px;margin-top:-14px;margin-left:-14px}.expression-wrapper .page-dots[data-v-61fa8290]{display:flex;position:absolute;width:100%;height:25px;margin-top:200px;align-items:center;justify-content:center}.expression-wrapper .page-dots .dot[data-v-61fa8290]{width:7px;height:7px;background-color:#ccc;border-radius:50%;margin:0 5px}.expression-wrapper .page-dots .dot.active[data-v-61fa8290]{width:9px;height:9px;background-color:#999}",""]),t.exports=e},1399:function(t,e,i){"use strict";var a=[{id:14,alt:"微笑"},{id:1,alt:"撇嘴"},{id:2,alt:"色"},{id:3,alt:"发呆"},{id:4,alt:"得意"},{id:5,alt:"流泪"},{id:6,alt:"害羞"},{id:7,alt:"闭嘴"},{id:8,alt:"睡"},{id:9,alt:"大哭"},{id:10,alt:"尴尬"},{id:11,alt:"发怒"},{id:12,alt:"调皮"},{id:13,alt:"呲牙"},{id:0,alt:"惊讶"},{id:15,alt:"难过"},{id:16,alt:"酷"},{id:96,alt:"冷汗"},{id:18,alt:"抓狂"},{id:19,alt:"吐"},{id:20,alt:"偷笑"},{id:21,alt:"可爱"},{id:22,alt:"白眼"},{id:23,alt:"傲慢"},{id:24,alt:"饥饿"},{id:25,alt:"困"},{id:26,alt:"惊恐"},{id:27,alt:"流汗"},{id:28,alt:"憨笑"},{id:29,alt:"大兵"},{id:30,alt:"奋斗"},{id:31,alt:"咒骂"},{id:32,alt:"疑问"},{id:33,alt:"嘘"},{id:34,alt:"晕"},{id:35,alt:"折磨"},{id:36,alt:"衰"},{id:37,alt:"骷髅"},{id:38,alt:"敲打"},{id:39,alt:"再见"},{id:97,alt:"擦汗"},{id:98,alt:"抠鼻"},{id:99,alt:"鼓掌"},{id:100,alt:"糗大了"},{id:101,alt:"坏笑"},{id:102,alt:"左哼哼"},{id:103,alt:"右哼哼"},{id:104,alt:"哈欠"},{id:105,alt:"鄙视"},{id:106,alt:"委屈"},{id:107,alt:"快哭了"},{id:108,alt:"阴险"},{id:109,alt:"亲亲"},{id:110,alt:"吓"},{id:111,alt:"可怜"},{id:112,alt:"菜刀"},{id:89,alt:"西瓜"},{id:113,alt:"啤酒"},{id:114,alt:"篮球"},{id:115,alt:"乒乓"},{id:60,alt:"咖啡"},{id:61,alt:"饭"},{id:46,alt:"猪头"},{id:63,alt:"玫瑰"},{id:64,alt:"凋谢"},{id:116,alt:"示爱"},{id:66,alt:"爱心"},{id:67,alt:"心碎"},{id:53,alt:"蛋糕"},{id:54,alt:"闪电"},{id:55,alt:"炸弹"},{id:56,alt:"刀"},{id:57,alt:"足球"},{id:117,alt:"瓢虫"},{id:59,alt:"便便"},{id:75,alt:"月亮"},{id:74,alt:"太阳"},{id:69,alt:"礼物"},{id:49,alt:"拥抱"},{id:76,alt:"强"},{id:77,alt:"弱"},{id:78,alt:"握手"},{id:79,alt:"胜利"},{id:118,alt:"抱拳"},{id:119,alt:"勾引"},{id:120,alt:"拳头"},{id:121,alt:"差劲"},{id:122,alt:"爱你"},{id:123,alt:"NO"},{id:124,alt:"OK"},{id:42,alt:"爱情"},{id:85,alt:"飞吻"},{id:43,alt:"跳跳"},{id:41,alt:"发抖"},{id:86,alt:"怄火"},{id:125,alt:"转圈"},{id:126,alt:"磕头"},{id:127,alt:"回头"},{id:128,alt:"跳绳"},{id:129,alt:"挥手"},{id:130,alt:"激动"},{id:131,alt:"街舞"},{id:132,alt:"献吻"},{id:133,alt:"左太极"},{id:134,alt:"右太极"},{id:135,alt:"嘿哈"},{id:136,alt:"捂脸"},{id:137,alt:"奸笑"},{id:138,alt:"机智"},{id:139,alt:"皱眉"},{id:140,alt:"耶"},{id:141,alt:"茶"},{id:142,alt:"红包"},{id:143,alt:"蜡烛"}],s={props:{active:{type:Boolean,default:!1},closeOnChoose:{type:Boolean,default:!1}},data:function(){return{containerWidth:0,pagesWidth:0,expressionPages:[],isDragging:!1,dragStart:{},dragDistant:0,pageLeft:0,containerLeft:0,currentPage:0}},mounted:function(){var t=[],e=[],i=a.length;a.map((function(a,s){if(a.offset=28*a.id,t.push(a),27==t.length&&(t.push({id:null,alt:"DELETE",offset:476}),e.push(t),t=[]),s==i-1){for(var o=27-t.length,n=0;n<o;n++)t.push({id:null,alt:"EMPTY",offset:9999});t.push({id:null,alt:"DELETE",offset:476}),e.push(t),t=[]}})),this.expressionPages=e,this.containerWidth=window.innerWidth,this.pagesWidth=this.containerWidth*this.expressionPages.length},methods:{pageDrag:function(t){this.isDragging=!0,this.dragStart={clientX:t.touches[0].clientX,timeStamp:t.timeStamp}},pageDragging:function(t){if(this.isDragging){t.preventDefault(),this.dragDistant=t.touches[0].clientX-this.dragStart.clientX;var e=this.pageLeft+this.dragDistant;e<=0&&e>=-(this.pagesWidth-this.containerWidth)&&(this.containerLeft=this.pageLeft+this.dragDistant)}},pageDrop:function(t){var e=Math.abs(this.dragDistant/this.containerWidth),i=t.timeStamp-this.dragStart.timeStamp;(e>=.3||e>.1&&i<500)&&(this.dragDistant<0?this.currentPage+=1:this.currentPage-=1),this.currentPage<0&&(this.currentPage=0),this.currentPage>this.expressionPages.length-1&&(this.currentPage=this.expressionPages.length-1),this.pageLeft=-this.currentPage*this.containerWidth,this.containerLeft=this.pageLeft,this.dragDistant=0,this.isDragging=!1},chooseExpression:function(t){this.$emit("choose",t),this.closeOnChoose&&this.closeExpression()},closeExpression:function(){this.$emit("close")}}},o=(i(1389),i(12)),n=Object(o.a)(s,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"container",staticClass:"expression-wrapper",style:{bottom:t.active?"0px":"-280px"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.active,expression:"active"}],staticClass:"expression-mask",on:{click:t.closeExpression}}),t._v(" "),i("ul",{class:["expression-container",t.isDragging?"":"transition"],style:{width:t.pagesWidth+"px",left:t.containerLeft+"px"},on:{touchstart:t.pageDrag,touchmove:t.pageDragging,touchend:t.pageDrop}},t._l(t.expressionPages,(function(e,a){return i("li",{key:a,staticClass:"expression-page",style:{width:t.containerWidth+"px"}},[i("ul",{staticClass:"expression-list"},t._l(e,(function(e){return i("li",{key:e.id,staticClass:"expression-item",on:{click:function(i){return t.chooseExpression(e)}}},[i("div",{staticClass:"expression-image bg-sprites-expression",style:{backgroundPosition:"0px -"+e.offset+"px"},attrs:{alt:e.alt}})])})),0)])})),0),t._v(" "),i("ul",{staticClass:"page-dots"},t._l(t.expressionPages,(function(e,a){return i("li",{key:a,class:["dot",t.currentPage==a?"active":""]})})),0)])}),[],!1,null,"61fa8290",null);e.a=n.exports},1452:function(t,e,i){"use strict";i(1368)},1453:function(t,e,i){(e=i(44)(!1)).push([t.i,".image-upload-container.has-content[data-v-5d676a7a]{margin:15px 0}.image-upload-container .image-upload-wrapper[data-v-5d676a7a]{overflow-x:auto;white-space:nowrap;-webkit-overflow-scrolling:touch}.image-upload-container .image-box[data-v-5d676a7a],.image-upload-container .image-upload[data-v-5d676a7a]{display:inline-block;position:relative;vertical-align:bottom;border:1px solid #f0f0f0;width:72px;height:72px;margin-right:15px;color:#e5e5e5}.image-upload-container .image-upload .icon-add-image[data-v-5d676a7a]{display:inline-block;width:40px;height:40px;margin:16px}.image-upload-container .image-upload-small[data-v-5d676a7a]{display:block;height:36px;padding-left:64px}.image-upload-container .image-upload-small .icon-add-image[data-v-5d676a7a]{display:inline-block;width:22px;height:20px;background-position:-47px -2504px}.image-upload-container .image-box .image[data-v-5d676a7a]{width:72px;height:72px;background-position:50%;background-size:cover;background-repeat:no-repeat}.image-upload-container .image-box .icon-remove-image[data-v-5d676a7a]{position:absolute;right:0;top:0;width:17px;height:17px;background-position:0 -1334px}.image-upload-container .skeleton[data-v-5d676a7a]{font-size:15px;text-align:center;line-height:72px;color:#fff;background-color:#e5e5e5;-webkit-animation:shine-data-v-5d676a7a 1.2s infinite;animation:shine-data-v-5d676a7a 1.2s infinite}@-webkit-keyframes shine-data-v-5d676a7a{0%{opacity:.4}to{opacity:1}}@keyframes shine-data-v-5d676a7a{0%{opacity:.4}to{opacity:1}}.image-upload-container.small .image-box[data-v-5d676a7a],.image-upload-container.small .image-upload[data-v-5d676a7a]{width:50px;height:50px}.image-upload-container.small .image-upload .icon-add-image[data-v-5d676a7a]{margin:5px}.image-upload-container.small .image-box .image[data-v-5d676a7a]{width:50px;height:50px}.image-upload-container.small .skeleton[data-v-5d676a7a]{font-size:12px;line-height:50px}.image-box .video[data-v-5d676a7a]{position:relative;width:100%;height:100%;background-color:#eee}.image-box .video .icon-play[data-v-5d676a7a]{position:absolute;width:0;height:0;left:50%;top:50%;margin-left:-6px;margin-top:-12px;border:12px solid transparent;border-left-color:#fff}.upload-file[data-v-5d676a7a]{display:none;opacity:0}",""]),t.exports=e},1479:function(t,e,i){"use strict";i(22),i(18),i(13),i(17),i(101),i(16),i(4),i(37);var a=i(6),s=i(0),o=i(319),n=i(28);function r(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function c(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?r(Object(i),!0).forEach((function(e){Object(s.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var l={count:9,sizeType:["original"],sourceType:["album","camera"],isShowProgressTips:0,url:"/assets/store-image"},d={name:"image-video-upload",components:{batchUpload:o.a},props:{options:{type:Object},init_data:{type:Array,default:function(){return[]}},size:{type:String,default:"normal",validate:function(t){return-1!==["small","normal"].indexOf(t)}},type:{type:String,default:"image"}},data:function(){var t=c(c({},l),this.options);return{isPCWechat:window.$device.isWechat&&window.$device.isPc,images:this.init_data,video:{},imageBusy:!1,videoBusy:!1,upload_options:t,limit:t.count,uploader:null,acceptTypes:["image/*"]}},computed:{showImages:function(){return this.images.map((function(t){return t.uuid?{local:t.serverData.url,url:t.serverData.url,uploadStatus:t.uploadStatus}:c(c({},t),{},{uploadStatus:n.e.SUCCESS})}))}},watch:{showImages:function(t){this.$emit("on-images-change",t.map((function(t){return t.url})).filter((function(t){return!!t})))},video:function(t){this.$emit("on-video-change",t)}},methods:{onSelect:function(t){var e=this;return Object(a.a)(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(e.$emit("on-images-choose"),!(e.images.length+t.length>9)){i.next=4;break}return e.$toast({msg:"最多上传9张图片，请重新选择",type:"text"}),i.abrupt("return",!1);case 4:return i.abrupt("return",!0);case 5:case"end":return i.stop()}}),i)})))()},beforeUpload:function(){},onProgress:function(){},onFileUploadSuccess:function(){this.$emit("on-images-success")},onFileUploadError:function(){this.$emit("on-images-fail")},getImage:function(){var t,e=this;(this.upload_options.count=this.limit-this.images.length,this.upload_options.count>0)?(null===(t=this.$wx)||void 0===t?void 0:t.apiSupport.chooseImage)&&this.enableSDKUpload?this.$wx.chooseImage(this.upload_options).then((function(t){var i=t.localIds,a=t.options;e.$emit("on-images-choose"),e.storeSDKImage(i,a)})).catch((function(){e.$refs.uploadImage.open()})):this.$refs.uploadImage.open():this.$toast({msg:"最多上传9张图片",type:"text"})},getVideo:function(){this.videoBusy||this.video.id?this.$alert({msg:"每次仅支持上传一个视频"}):this.$refs.uploadVideo.click()},storeSDKImage:function(t,e){var i=this,a=t.shift();this.imageBusy=!0,console.log("king test storeSDKImage",t,e),this.$wx.uploadImage(a,e).then((function(a){i.images.push({local:a,url:a}),i.imageBusy=!1,i.$emit("on-images-success"),t.length&&i.storeSDKImage(t,e)}))},getVideoDuration:function(t){return new Promise((function(e,i){window.URL=window.URL||window.webkitURL;var a=document.createElement("video");a.preload="metadata",a.onloadedmetadata=function(){window.URL.revokeObjectURL(a.src),e(a.duration)},a.onerror=function(t){i("video load error",t)},a.src=URL.createObjectURL(t)}))},isOverTime:function(t){var e=this;return Object(a.a)(regeneratorRuntime.mark((function i(){var a;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,e.getVideoDuration(t);case 2:return a=i.sent,i.abrupt("return",a>e.options.videoDurationLimit);case 4:case"end":return i.stop()}}),i)})))()},storeVideo:function(t){var e=this;if(t.target.files.length){var a=t.target.files[0],s=a.name.substr(a.name.lastIndexOf(".")+1).toUpperCase();if(!a.type)return!1;-1===["WMV","WM","ASF","ASX","RM","RMVB","RA","RAM","MPG","MPEG","MPE","VOB","DAT","MOV","3GP","MP4","MP4V","M4V","MKV","AVI","FLV","F4V"].indexOf(s)?this.$alert({msg:"不支持此格式文件"}):a.size>2147483648?this.$alert({msg:"不支持超过2G的视频"}):this.options.videoLimitDuration&&!0===this.isOverTime(a)?this.$alert({msg:"不支持超过".concat(this.options.videoLimitDuration,"秒的视频")}):(this.$emit("on-video-choose"),this.videoBusy=!0,Promise.all([i.e(16),i.e(26)]).then(i.t.bind(null,3434,7)).then((function(t){var i=new(0,t.default)({getSignature:function(){return e.$http.get("/videos/signature").then((function(t){return t.data}))}});e.uploader=i.upload({mediaFile:a}),e.uploader.done().then((function(t){e.$http.post("/videos",{vod_file_id:t.fileId,name:a.name}).then((function(t){var i=t.data;e.videoBusy=!1,e.video=i,e.$emit("on-video-success")})).catch((function(t){e.$emit("on-video-fail"),e.httpError(t)}))})).catch((function(t){e.$toast({msg:"上传失败:".concat(t.response.data.message)})}))})))}},destroyImage:function(t){var e=this;this.$confirm({title:"提示",msg:"确定要删除图片吗？"},(function(){var i=e.images.findIndex((function(e){return e.uploadStatus?e.serverData.url===t.url:e.url===t.url}));e.images.splice(i,1)}))},destroyVideo:function(){var t=this;this.$confirm({title:"提示",msg:"确定要删除视频吗？"},(function(){t.video={},t.uploader.cancel()}))}}},u=(i(1452),i(12)),p=Object(u.a)(d,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.isPCWechat?t._e():i("div",{staticClass:"image-upload-container",class:t.size},[i("div",{staticClass:"image-upload-wrapper"},[t._l(t.showImages,(function(e){return i("div",{key:e.local,staticClass:"image-box"},["SUCCESS"===e.uploadStatus?i("div",[i("div",{directives:[{name:"show",rawName:"v-show",value:e.local,expression:"image.local"}],staticClass:"image",style:{backgroundImage:"url("+e.local+")"},on:{click:function(i){return i.preventDefault(),t.destroyImage(e)}}}),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:e.local,expression:"image.local"}],staticClass:"bg-sprites icon-remove-image",on:{click:function(i){return i.preventDefault(),t.destroyImage(e)}}})]):"FAILED"===e.uploadStatus?i("div",[i("div",{staticClass:"skeleton"},[t._v("上传失败")]),t._v(" "),i("span",{staticClass:"bg-sprites icon-remove-image",on:{click:function(i){return i.preventDefault(),t.destroyImage(e)}}})]):i("div",[i("div",{staticClass:"skeleton"},[t._v("加载中...")])])])})),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.imageBusy,expression:"imageBusy"}],staticClass:"image-box skeleton"},[t._v("加载中...")]),t._v(" "),i("a",{directives:[{name:"show",rawName:"v-show",value:t.showImages.length&&t.showImages.length<t.limit&&!t.imageBusy,expression:"showImages.length && showImages.length < limit && !imageBusy"}],staticClass:"image-upload",on:{click:function(e){return e.preventDefault(),t.getImage(e)}}},[i("svg-icon",{staticClass:"icon-add-image",attrs:{name:"common/add",width:41,height:41}})],1)],2),t._v(" "),i("div",{staticClass:"image-upload-wrapper"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.video.id,expression:"video.id"}],staticClass:"image-box"},[i("div",{staticClass:"video",on:{click:function(e){return e.preventDefault(),t.destroyVideo(e)}}},[i("span",{staticClass:"icon-play"}),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:t.video.id,expression:"video.id"}],staticClass:"bg-sprites icon-remove-image",on:{click:function(e){return e.preventDefault(),t.destroyVideo(e)}}})])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.videoBusy,expression:"videoBusy"}],staticClass:"image-box skeleton"},[t._v("加载中...")])]),t._v(" "),i("batch-upload",{ref:"uploadImage",staticClass:"course-upload",attrs:{multiple:!0,"cos-direct":!0,"accept-types":t.acceptTypes,"on-select":t.onSelect},on:{"before-upload":t.beforeUpload,"on-progress":t.onProgress,"on-success":t.onFileUploadSuccess,"on-error":t.onFileUploadError},model:{value:t.images,callback:function(e){t.images=e},expression:"images"}}),t._v(" "),i("input",{ref:"uploadVideo",staticClass:"upload-file",attrs:{type:"file",accept:"video/*",name:""},on:{change:t.storeVideo}})],1)}),[],!1,null,"5d676a7a",null);e.a=p.exports},1777:function(t,e,i){var a=i(2333);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,i(45).default)("4eb10b14",a,!0,{sourceMap:!1})},2332:function(t,e,i){"use strict";i(1777)},2333:function(t,e,i){(e=i(44)(!1)).push([t.i,".post-create-container .title[data-v-5ddee0f1]{font-size:17px;padding:15px 15px 0;line-height:24px}.post-create-container .ref-content[data-v-5ddee0f1]{color:#999;font-size:14px;margin-top:10px;line-height:24px}.operations[data-v-5ddee0f1]{height:36px;padding:5px 15px 0}.operations .operation[data-v-5ddee0f1]{float:left;margin-right:25px}.operations .icon-anonymous[data-v-5ddee0f1],.operations .icon-at[data-v-5ddee0f1],.operations .icon-expression[data-v-5ddee0f1],.operations .icon-image[data-v-5ddee0f1],.operations .icon-video[data-v-5ddee0f1]{width:22px;height:20px;display:inline-block;vertical-align:middle;background-position:1px -2504px}.operations .icon-image[data-v-5ddee0f1]{left:60px;background-position:-47px -2504px}.operations .icon-video[data-v-5ddee0f1]{background-position:0 -3836px}.operations .icon-expression[data-v-5ddee0f1]{left:120px;background-position:-96px -2504px}.operations .icon-anonymous[data-v-5ddee0f1]{background-position:-133px -2505px}.operations .icon-anonymous.active[data-v-5ddee0f1]{background-position:-161px -2505px}",""]),t.exports=e},3527:function(t,e,i){"use strict";i.r(e);i(61);var a=i(50),s=(i(13),i(4),i(1245),i(60),i(16),i(1479)),o=i(1300),n=i(1399),r={name:"thread-post-create",components:{imageVideoUpload:s.a,userAt:o.a,expression:n.a},data:function(){return{post:"",imagesUrl:[],uploadedVideo:{},enableContact:this.$store.state.company.enable_contact,enableThreadAt:this.$store.state.company.enable_thread_at,isShowExpression:!1,isSaved:!1,isBanned:!1,isShowAt:!1,isAnonymous:!1,isChooseImage:!1}},asyncData:function(t){var e=t.app,i=t.store,a=t.route,s=t.error,o=t.req,n=t.res,r=a.params.threadId,c={title:"",refContent:"",refId:a.query.ref_id||"",thread:{}};return c.refId?e.$http.get("/threads/".concat(r,"/posts/").concat(c.refId)).then((function(t){var i=t.data;return c.title=e.$isPcg?"".concat(i.owner.display_name):"".concat(i.floor,"楼# ").concat(i.owner.display_name),c.refContent=i.summary,c.thread=i,c})).catch((function(t){return i.dispatch("errorCatch",{error:s,req:o,res:n,err:t})})):e.$http.get("/threads/".concat(r)).then((function(t){var e=t.data;return c.title=e.title,c.thread=e,c})).catch((function(t){return i.dispatch("errorCatch",{error:s,req:o,res:n,err:t})}))},computed:{company:function(){return this.$store.state.company},invalidItems:function(){var t=this;return[{msg:"内容不能为空",format:function(){return!t.post&&!t.imagesUrl.length&&!t.uploadedVideo.id}}].filter((function(t){return t.format()}))},idNameMap:function(){return this.$store.state.comment.idNameMap},companyServerType:function(){return this.$store.state.companyServerType}},mounted:function(){var t=this;this.$http.get("/staff/check-banned").then((function(e){var i=e.data;return t.isBanned=!!parseInt(i,10)})).catch((function(e){return t.httpError(e)})),this.thread.lock&&this.$alert({msg:"该帖已锁，无法回帖"}).then((function(){t.$router.push("/threads/".concat(t.thread.id))})),this.$wx.share({title:this.thread.title||this.thread.summary,desc:"回复帖子"}),this.$wx.init().then((function(){t.isChooseImage=!0}))},methods:{userAt:function(t){this.post+="@".concat(t," "),this.isShowAt=!1},at:function(){var t=this;this.$device.isWechat||!this.$wx.apiSupport.selectEnterpriseContact||"lexiang"===this.companyServerType?this.isShowAt=!0:this.$wx.selectEnterpriseContact({mode:"multi"}).then((function(e){var i=e.result.userList,a="";i.forEach((function(e){a+="@".concat(e.name," "),t.$store.dispatch("comment/add_id_name_map",{id:e.id,name:e.name})})),t.post+=a}))},hideExpression:function(){this.isShowExpression=!1},toggleExpression:function(){this.isShowExpression=!this.isShowExpression},chooseExpression:function(t){null!=t.id?this.post+="/".concat(t.alt," "):this.post=this.post.replace(/\/.{1,3}\s$/,"")},toggleAnonymous:function(){this.isAnonymous=!this.isAnonymous,this.$toast({msg:this.isAnonymous?"此贴将匿名发表":"取消匿名发帖"})},store:function(t){var e=this,i=t.target,s=this.$route.params.threadId;if(this.isBanned)this.$alert("你已被禁言");else if(!this.invalidItems.length||i.disabled){i.disabled=!0;var o=this.imagesUrl.length?"".concat(this.post?"<br>":"").concat(this.imagesUrl.reduce((function(t,e){return"".concat(t,'<img src="').concat(e,'"><br>')}),"")):"",n=this.uploadedVideo.id?'<br /><img id="video-'.concat(this.uploadedVideo.id,'" class="swan-video-container" src="').concat(this.$config.APP_BUILD_ASSETS?"/build":"",'/img/video-placeholder.png" /><br />'):"",r={is_anonymous:this.isAnonymous,content:"".concat(this.post.htmlspecialchars().replace(/\n/g,"<br />"),"&nbsp;").concat(o).concat(n),ref_id:this.refId};Object.entries(this.idNameMap).forEach((function(t){var e=Object(a.a)(t,2),i=e[0],s=e[1];r.content=r.content.split("@".concat(i)).join("@#".concat(s))})),this.$http.post("/threads/".concat(s,"/posts"),r).then((function(){e.isSaved=!0,e.$toast({msg:"回帖成功"}).then((function(){e.$router.go(-1)}))}),(function(){i.disabled=!1}))}else this.$alert("".concat(this.invalidItems[0].msg))}}},c=(i(2332),i(12)),l=Object(c.a)(r,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.title?i("div",{staticClass:"post-create-container bg-color-gray"},[i("div",{staticClass:"title long-break"},[t._v("\n    回复："+t._s(t.title)+"\n    "),t.refContent?i("div",{staticClass:"ref-content"},[t._v(t._s(t.refContent))]):t._e()]),t._v(" "),i("div",{staticClass:"weui-cells weui-cells_form"},[i("div",{staticClass:"weui-cell"},[i("div",{staticClass:"weui-cell__bd"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.post,expression:"post"}],staticClass:"weui-textarea",attrs:{placeholder:"请输入回帖内容",rows:"4"},domProps:{value:t.post},on:{input:function(e){e.target.composing||(t.post=e.target.value)}}})])]),t._v(" "),i("div",[t.isChooseImage?i("image-video-upload",{ref:"imageVideoUpload",staticClass:"weui-cell",attrs:{options:{count:9,url:"/assets/store-image",isShowProgressTips:1}},on:{"on-video-change":function(e){t.uploadedVideo=e},"on-images-change":function(e){t.imagesUrl=e}}}):t._e(),t._v(" "),i("ul",{staticClass:"operations"},[t.enableContact&&t.enableThreadAt?i("li",{staticClass:"operation icon-at bg-sprites",on:{click:t.at}}):t._e(),t._v(" "),t.isChooseImage?i("li",{staticClass:"operation icon-image bg-sprites",on:{click:function(e){return t.$refs.imageVideoUpload.getImage()}}}):t._e(),t._v(" "),t.isChooseImage?i("li",{staticClass:"operation icon-video bg-sprites",on:{click:function(e){return t.$refs.imageVideoUpload.getVideo()}}}):t._e(),t._v(" "),i("li",{staticClass:"operation icon-expression bg-sprites",on:{click:function(e){return e.stopPropagation(),t.toggleExpression(e)}}}),t._v(" "),t.company.enable_anonymous_post?i("li",{staticClass:"operation icon-anonymous bg-sprites",class:{active:t.isAnonymous},on:{click:t.toggleAnonymous}}):t._e()])],1)]),t._v(" "),i("div",{staticClass:"weui-btn-area"},[i("button",{staticClass:"weui-btn weui-btn_primary",on:{click:function(e){return e.preventDefault(),t.store(e)}}},[t._v("发表")])]),t._v(" "),t.isShowAt?i("user-at",{on:{"on-user-at":t.userAt}}):t._e(),t._v(" "),i("expression",{attrs:{active:t.isShowExpression},on:{close:t.hideExpression,choose:t.chooseExpression}})],1):t._e()}),[],!1,null,"5ddee0f1",null);e.default=l.exports}}]);
//# sourceMappingURL=create.45196f5b3c8cad2dd2fc.js.map